%define name    gst-plugins  
%define ver     0.3.02
%define rel     20011221
%define prefix  /usr
%define sysconfdir /etc

Summary: GStreamer Streaming-media framework plugins
Name: %name
Version: %ver
Release: %rel
Copyright: LGPL
Group: Libraries/Multimedia
Source: %{name}-%{ver}.tar.gz
BuildRoot: /var/tmp/%{name}-%{ver}-root
Docdir: %{prefix}/doc
Prefix: %prefix
Requires: libxml >= 1.8.0
BuildRequires: nasm => 0.90

%description
GStreamer is a streaming-media framework, based on graphs of filters which
operate on media data. Applications using this library can do anything
from real-time sound processing to playing videos, and just about anything
else media-related.  Its plugin-based architecture means that new data
types or processing capabilities can be added simply by installing new
plugins.

%files
%defattr(-, root, root)
%doc AUTHORS COPYING README  

%prep
%setup
%build
CFLAGS="$RPM_OPT_FLAGS" ./configure --prefix=%{prefix} --sysconfdir=%{sysconfdir} --mandir=$RPM_BUILD_ROOT%{prefix}/share/man  --enable-glib2

if [ "$SMP" != "" ]; then
  (make "MAKE=make -k -j $SMP"; exit 0)
  make 2>&1 | tee make.log
else
  make 2>&1 | tee make.log
fi

%install
[ -n "$RPM_BUILD_ROOT" -a "$RPM_BUILD_ROOT" != / ] && rm -rf $RPM_BUILD_ROOT

make prefix=$RPM_BUILD_ROOT%{prefix} install

%clean
[ -n "$RPM_BUILD_ROOT" -a "$RPM_BUILD_ROOT" != / ] && rm -rf $RPM_BUILD_ROOT

### ESD ###
@USE_ESD_TRUE@%package -n gstreamer-esd
@USE_ESD_TRUE@Summary: Gstreamer plugin for ESD sound output
@USE_ESD_TRUE@Group: Libraries/Multimedia
@USE_ESD_TRUE@Requires: esound >= 0.2.8
@USE_ESD_TRUE@Requires: %{name} = %{ver}
@USE_ESD_TRUE@
@USE_ESD_TRUE@%description -n gstreamer-esd
@USE_ESD_TRUE@Output plugin for GStreamer for use with the esound package
@USE_ESD_TRUE@
@USE_ESD_TRUE@%files -n gstreamer-esd
@USE_ESD_TRUE@%defattr(-, root, root)
@USE_ESD_TRUE@%{prefix}/lib/gst/libesd*
@USE_ESD_TRUE@
@USE_ESD_TRUE@%post -n gstreamer-esd
@USE_ESD_TRUE@%{prefix}/bin/gstreamer-register --gst-mask=0
@USE_ESD_TRUE@
@USE_ESD_TRUE@%postun -n gstreamer-esd
@USE_ESD_TRUE@%{prefix}/bin/gstreamer-register --gst-mask=0
@USE_ESD_TRUE@/sbin/ldconfig

### MAD ###
@USE_MAD_TRUE@%package -n gstreamer-mad  
@USE_MAD_TRUE@Summary: Plugin using MAD for mp3 decoding
@USE_MAD_TRUE@Group: Libraries/Multimedia
@USE_MAD_TRUE@Requires: %{name} = %{ver}
@USE_MAD_TRUE@Requires: mad >= 0.13.0
@USE_MAD_TRUE@
@USE_MAD_TRUE@%description -n gstreamer-mad
@USE_MAD_TRUE@Plugin for playback of mp3 songs using the very good MAD library
@USE_MAD_TRUE@
@USE_MAD_TRUE@%files -n gstreamer-mad
@USE_MAD_TRUE@%defattr(-, root, root)  
@USE_MAD_TRUE@%{prefix}/lib/gst/libgstmad*
@USE_MAD_TRUE@
@USE_MAD_TRUE@%post -n gstreamer-mad
@USE_MAD_TRUE@%{prefix}/bin/gstreamer-register --gst-mask=0
@USE_MAD_TRUE@
@USE_MAD_TRUE@%postun -n gstreamer-mad
@USE_MAD_TRUE@%{prefix}/bin/gstreamer-register --gst-mask=0
@USE_MAD_TRUE@/sbin/ldconfig

### OSS ###
@USE_OSS_TRUE@%package -n gstreamer-oss
@USE_OSS_TRUE@Summary: Gstreamer plugins for input and output using OSS
@USE_OSS_TRUE@Group: Libraries/Multimedia
@USE_OSS_TRUE@Requires: %{name} = %{ver}
@USE_OSS_TRUE@
@USE_OSS_TRUE@%description -n gstreamer-oss 
@USE_OSS_TRUE@Plugins for output and input to the OpenSoundSytem audio
@USE_OSS_TRUE@drivers found in the Linux kernels or commercially available
@USE_OSS_TRUE@from OpenSound.
@USE_OSS_TRUE@
@USE_OSS_TRUE@%files -n gstreamer-oss
@USE_OSS_TRUE@%defattr(-, root, root)
@USE_OSS_TRUE@%{prefix}/lib/gst/libgstoss*
@USE_OSS_TRUE@
@USE_OSS_TRUE@%post -n gstreamer-oss
@USE_OSS_TRUE@%{prefix}/bin/gstreamer-register --gst-mask=0
@USE_OSS_TRUE@
@USE_OSS_TRUE@%postun -n gstreamer-oss
@USE_OSS_TRUE@%{prefix}/bin/gstreamer-register --gst-mask=0
@USE_OSS_TRUE@/sbin/ldconfig

### Vorbis ###
@USE_VORBIS_TRUE@%package -n gstreamer-vorbis
@USE_VORBIS_TRUE@Summary: Gstreamer plugin for encoding and decoding Ogg Vorbis audio files
@USE_VORBIS_TRUE@Group: Libraries/Multimedia
@USE_VORBIS_TRUE@Requires: libogg >= 1.0beta4
@USE_VORBIS_TRUE@Requires: libvorbis >= 1.0beta4
@USE_VORBIS_TRUE@Requires: %{name} = %{ver}
@USE_VORBIS_TRUE@
@USE_VORBIS_TRUE@%description -n gstreamer-vorbis
@USE_VORBIS_TRUE@Plugins for creating and playing Ogg Vorbis audio files.
@USE_VORBIS_TRUE@
@USE_VORBIS_TRUE@%files -n gstreamer-vorbis  
@USE_VORBIS_TRUE@%defattr(-, root, root)
@USE_VORBIS_TRUE@%{prefix}/lib/gst/libgstvorbis*
@USE_VORBIS_TRUE@
@USE_VORBIS_TRUE@%post -n gstreamer-vorbis
@USE_VORBIS_TRUE@%{prefix}/bin/gstreamer-register --gst-mask=0
@USE_VORBIS_TRUE@
@USE_VORBIS_TRUE@%postun -n gstreamer-vorbis
@USE_VORBIS_TRUE@%{prefix}/bin/gstreamer-register --gst-mask=0
@USE_VORBIS_TRUE@/sbin/ldconfig
